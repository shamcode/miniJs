miJs=miniJs=function(){function t(e,t){var n=!!t;this.result=undefined;this.chain=function(){n=!n;return n?this:this.result};this.clone=function(t,r){e=this.result||e;var i=function(e,t,n){var r=e instanceof Array?[]:{};for(var i=0;i<e.length;i++){if(t&&!!n==(t&&t.indexOf?t.indexOf(i)!==-1:miJs.object(i).in(t)))continue;r[i]=typeof e[i]=="object"?arguments.callee(e[i]):e[i]}return r}(e,t,r);if(n){if(i instanceof Array)return miJs.array(i,true);else{this.result=i;return this}}else return i};this.equal=function(t){e=this.result||e;var r=function(e,t){if(e==undefined||t==undefined)return e==t;if(e.length!=t.length)return false;if(e.length==undefined&&e.toString()!=t.toString())return false;for(var n=0;n<e.length;n++)if(typeof e[n]=="object"){if(!(t[n]&&arguments.callee(e[n],t[n])))return false}else if(typeof e[n]=="function"){if(e[n].toString()!=t[n].toString())return false}else if(e[n]!==t[n])return false;return true}(e,t);return n?(this.result=r,this):r};this.in=function(t){e=this.result||e;for(var r=0;r<t.length;r++)if(miJs.object(e).equal(t[r]))return n?(this.result=true,this):true;return n?(this.result=false,this):false};this.alert=function(t,r){e=this.result!==undefined?this.result:e;var i="";for(var s=0;s<e.length;s++)if(r)i+=miniJs.object(s).in(t)?"":s+"="+e[s].toString()+"\n";else i+=t?miniJs.object(s).in(t)?s+"="+e[s].toString()+"\n":"":s+"="+(e[s]==undefined?"":e[s].toString())+"\n";if((typeof e!="object")>(e instanceof Array))i=e.toString();alert(i);if(n)return this};this.set=function(t,r){e=this.result||e;var i=typeof r=="function";for(var s=0;s<t.length;s++){if(i){if(!r(e,t,s))continue}else if(r&&e[s]!==undefined)continue;if(typeof t[s]=="object"){if(e[s]==undefined)e[s]=t[s]instanceof Array?[]:{};miniJs.object(e[s]).set(t[s],r)}else if(typeof t[s]=="function")e[s]=miniJs.function(t[s]).clone();else e[s]=t[s]}if(n)return this};this.with=function(){e=this.result||e;miniJs.this=e;if(n)return this};this.diff=function(t,r){e=this.result||e;var i=[];for(var s=0;s<e.length;s++)if(!(t[s]&&miJs.object(e[s]).equal(t[s])));i.push(s);var o=miJs.object(r?t:e).clone(i);return n?(this.result=o,this):o};this.keys=function(){e=this.result||e;if(Object.keys!==undefined)return n?(this.result=Object.keys(e),this):Object.keys(e);var t=[];for(var r=0;r<e.length;r++)t.push(r);return n?(this.result=t,this):t};this.value=function(t){e=this.result||e;return n?(this.result=e[t],this):e[t]};this.key=function(t){e=this.result||e;for(var r=0;r<e;r++)if(miJs.object(e[r]).equal(t))return n?(this.result=r,this):r;return n?(this.result=undefined,this):undefined};this.array=function(){e=this.result||e;var t=miJs.array(e,n);return n?(t.result=e,t):t};this.function=function(){e=this.result||e;var t=miJs.function(e,n);return n?(t.result=e,t):t};this.externCall=function(t,n){e=this.result||e;var r=t(e);if(n)this.result=r;return this}}function n(e,t){var n=!!t;this.result=undefined;this.chain=function(){n=!n;return n?this:this.result};this.clone=function(){e=this.result||e;return n?(this.result=e.slice(0),this):e.slice(0)};this.equal=function(t){e=this.result||e;return n?(this.result=miJs.object(e).equal(t),this):miJs.object(e).equal(t)};this.alert=function(){e=this.result!==undefined?this.result:e;var t="";for(var r=0;r<e.length;r++)t+=r+"="+e[r].toString()+"\n";if(typeof e!="object")t+=""+e;alert(t);if(n)return this};this.map=function(t){e=this.result||e;if(e.map!==undefined)return n?(this.result=e.map(t),this):e.map(t);var r=[];for(var i=0;i<e.length;i++)r.push(t(e[i]));return n?(this.result=r,this):r};this.filter=function(t){e=this.result||e;if(e.filter!==undefined)return n?(this.result=e.filter(t),this):e.filter(t);var r=[];for(var i=0;i<e.length;i++)if(t(e[i]))r.push(e);return n?(this.result=r,this):r};this.uniq=function(){e=this.result||e;var t=[];for(var r=0;r<e.length;r++){if(!miJs.object(e[r]).in(t)){var i=0;for(var s=0;s<e.length;s++){if(miJs.object(e[r]).equal(e[s]))i++;if(i>1){t.push(e[r]);break}}if(i==1)t.push(e[r])}}return n?(this.result=t,this):t};this.delete=function(e){var t=this.filter(function(t){return!miJs.object(t).equal(e)});return n?this:t};this.each=function(t){e=this.result||e;if(e.forEach!==undefined)return n?(e.forEach(t),this):e.forEach(t);for(var r=0;r<e.length;r++)t(e[r]);if(n)return this};this.value=function(t){e=this.result||e;return n?(this.result=e[t],this):e[t]};this.index=function(t,r){e=this.result||e;for(var i=0;i<e.length;i++)if(r?t(e[i]):miJs.object(e[i]).equal(t))return n?(this.result=i,this):i;return n?(this.result=i,this):undefined};this.object=function(){e=this.result||e;var t=miJs.object(e,n);return n?(t.result=e,t):t};this.function=function(){e=this.result||e;var t=miJs.function(e,n);return n?(t.result=e,t):t};this.reduce=function(t,r){e=this.result||e;var i=r;if(e.reduce)i=e.reduce(t,i);else for(var s=0;s<e.length;s++)i=t(i,e[s]);return n?(this.result=i,this):i};this.externCall=function(t,n){e=this.result||e;var r=t(e);if(n)this.result=r;return this}}function r(e,t){var n=!!t;this.result=undefined;this.chain=function(){n=!n;return n?this:this.result};this.cache=function(){var t=function(){for(var n in t.base.argument)if(t.base.argument.hasOwnProperty(n)&&miniJs.object(t.base.argument[n]).equal(arguments));return t.base.retValue[n];t.base.argument.push(arguments);var r=e.apply(this,arguments);t.base.retValue.push(r);return r};var r;t.base={argument:[],retValue:[]};return n?(r=miJs.function(t,true),r.result=t,r):t};this.log=function(){var t=function(){var n=e.apply(this,arguments);t.log.push({args:arguments,ret:n});return n};var r;t.log=[];return n?(r=miJs.function(t,true),r.result=t,r):t};this.clone=function(){var t=function(){return e.apply({},arguments)};var r;for(var i in e)t[i]=e[i];return n?(r=miJs.function(t,true),r.result=t,r):t};this.objectArgument=function(){var t,r=Array.prototype.slice.call(arguments),i=function(t){var n=[],i=function(e,t){miJs.object(e,true).keys().array().each(function(s){var o=r.indexOf(t+s);if(o!==-1)n[o]=e[s];else i(e[s],t+s+".")})};i(t,"");return e.apply(this,n)};return n?(t=miJs.function(i,true),t.result=i,t):i};this.profile=function(){var t,r=function(){var t=(new Date).getTime(),n=e.apply(this,arguments),i=(new Date).getTime()-t;r.count++;r.time.all.push(i);return n};r.time={max:function(){return Math.max.apply(Math,r.time.all)},min:function(){return Math.min.apply(Math,r.time.all)},middle:function(){return miJs.array(r.time.all).reduce(function(e,t){return e+t},0)/r.time.all.length},all:[]};r.count=0;return n?(t=miJs.function(r,true),t.result=r,t):r};this.externCall=function(t,r){var i=t(e),s=miJs.function(i,n);if(r)s.result=i;return s}}function i(e,t){var n=!!t;this.result=undefined;this.chain=function(){n=!n;return n?this:this.result};this.lambda=function(){var t=[],n=e,r;if(/\s*:\s*/.test(n)!=null){exprArgs=e.split(/\s*:\s*/);t=exprArgs[0].split(/\s*,\s*|\s+/m);n=exprArgs.slice(1).join(":")}else throw"String '"+e+"' can't convert to Function";return new Function(t,"return ("+n+")")}}var e=function(e,s){if(arguments.length){if(e instanceof Array)return new n(e,s);if(typeof e=="function")return new r(e,s);if(typeof e=="string")return new i(e,s);return new t(e,s)}};e.object=function(e,n){return new t(e,n)};e.array=function(e,t){return new n(e,t)};e.function=function(e,t){return new r(e,t)};e.string=function(e,t){return new i(e,t)};e.alert=function(){var e="";for(var t=0;t<arguments.length;t++)e+=t+": "+arguments[t]+"\n";alert(e)};e.timer=function(){var e=(new Date).getTime();return function(){return(new Date).getTime()-e}};e.this=undefined;return e}()