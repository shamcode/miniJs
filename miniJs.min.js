miJs=miniJs=function(){function t(e,t){var n=!!t;this.result=undefined;this.chain=function(){n=!n;return n?this:this.result};this.clone=function(t,r){e=this.result||e;var i=function(e,t,n){var r=e instanceof Array?[]:{};for(var i=0,s=miJs.object(e).keys();i<s.length;i++){var o=s[i];if(t&&!!n==(t&&t.indexOf?t.indexOf(o)!==-1:miJs.object(o).in(t)))continue;r[o]=typeof e[o]=="object"?arguments.callee(e[o]):e[o]}return r}(e,t,r);if(n){if(i instanceof Array)return miJs.array(i,true);else{this.result=i;return this}}else return i};this.equal=function(t){e=this.result||e;var r=function(e,t){if(e==undefined||t==undefined)return e==t;if(e.length!=t.length)return false;if(e.toString()!=t.toString())return false;if(!isNaN(e)&&!isNaN(t))return e==t;if((typeof e=="string"||e instanceof String)&&(typeof t=="string"||t instanceof String))return e==t;for(var n=0,r=miJs.object(e).keys();n<r.length;n++){var i=r[n];if(typeof e[i]=="object"){if(!(t[i]&&arguments.callee(e[i],t[i])))return false}else if(typeof e[i]=="function"){if(e[i].toString()!=t[i].toString())return false}else if(e[i]!==t[i])return false}return true}(e,t);return n?(this.result=r,this):r};this.in=function(t){e=this.result||e;for(var r=0;r<t.length;r++)if(miJs.object(e).equal(t[r]))return n?(this.result=true,this):true;return n?(this.result=false,this):false};this.alert=function(t,r){e=this.result!==undefined?this.result:e;var i="";for(var s=0,o=e.keys();s<o.length;s++){var u=o[s];if(r)i+=miniJs.object(u).in(t)?"":u+"="+e[u].toString()+"\n";else i+=t?miniJs.object(u).in(t)?u+"="+e[u].toString()+"\n":"":u+"="+(e[u]==undefined?"":e[u].toString())+"\n"}if((typeof e!="object")>(e instanceof Array))i=e.toString();alert(i);if(n)return this};this.set=function(t,r){e=this.result||e;var i=typeof r=="function";for(var s=0,o=miJs.object(t).keys();s<o.length;s++){var u=o[s];if(i){if(!r(e,t,u)){continue}}else if(r&&e[u]!==undefined){continue}if(typeof t[u]=="object"){if(e[u]==undefined){e[u]=t[u]instanceof Array?[]:{}}miniJs.object(e[u]).set(t[u],r)}else if(typeof t[u]=="function"){e[u]=miniJs.function(t[u]).clone()}else{e[u]=t[u]}}if(n)return this};this.with=function(){e=this.result||e;miniJs.this=e;if(n){return this}};this.diff=function(t,r){e=this.result||e;var i=[];for(var s=0,o=miJs.object(e).keys();s<o.length;s++){var u=o[s];if(!miJs.object(e[u]).equal(t[u])){i.push(u)}}var a=miJs.object(r?t:e).clone(i);return n?(this.result=a,this):a};this.keys=function(){e=this.result||e;if(Object.keys!==undefined){return n?(this.result=Object.keys(e),this):Object.keys(e)}var t=[];for(var r in e){t.push(r)}return n?(this.result=t,this):t};this.value=function(t){e=this.result||e;return n?(this.result=e[t],this):e[t]};this.key=function(t){e=this.result||e;for(var r=0,i=miJs.object(e).keys();r<i.length;r++){var s=i[r];if(miJs.object(e[s]).equal(t)){return n?(this.result=s,this):s}}return n?(this.result=undefined,this):undefined};this.array=function(){e=this.result||e;var t=miJs.array(e,n);return n?(t.result=e,t):t};this.function=function(){e=this.result||e;var t=miJs.function(e,n);return n?(t.result=e,t):t};this.external=function(t,n){e=this.result||e;var r=t(e);if(n)this.result=r;return this}}function n(e,t){var n=!!t;this.result=undefined;this.chain=function(){n=!n;return n?this:this.result};this.clone=function(){e=this.result||e;return n?(this.result=miJs.object(e).clone(),this):miJs.object(e).clone()};this.equal=function(t){e=this.result||e;return n?(this.result=miJs.object(e).equal(t),this):miJs.object(e).equal(t)};this.alert=function(){e=this.result!==undefined?this.result:e;var t="";for(var r=0;r<e.length;r++){t+=r+"="+e[r].toString()+"\n"}if(typeof e!="object"){t+=""+e}alert(t);if(n){return this}};this.map=function(t){e=this.result||e;if(e.map!==undefined){return n?(this.result=e.map(t),this):e.map(t)}var r=[];for(var i=0;i<e.length;i++){r.push(t(e[i]))}return n?(this.result=r,this):r};this.filter=function(t){e=this.result||e;if(e.filter!==undefined)return n?(this.result=e.filter(t),this):e.filter(t);var r=[];for(var i=0;i<e.length;i++)if(t(e[i]))r.push(e);return n?(this.result=r,this):r};this.distinct=function(){e=this.result||e;var t=[];for(var r=0;r<e.length;r++){if(!miJs.object(e[r]).in(t)){var i=1;for(var s=r+1;s<e.length;s++){if(miJs.object(e[r]).equal(e[s])){i++}if(i>1){t.push(e[r]);break}}if(i==1){t.push(e[r])}}}return n?(this.result=t,this):t};this.delete=function(e){return this.filter(function(t){return!miJs.object(t).equal(e)})};this.each=function(t){e=this.result||e;if(e.forEach!==undefined){return n?(e.forEach(t),this):e.forEach(t)}for(var r=0;r<e.length;r++){t(e[r])}if(n){return this}};this.value=function(t){e=this.result||e;return n?(this.result=e[t],this):e[t]};this.index=function(t,r){e=this.result||e;for(var i=0;i<e.length;i++){if(r?t(e[i]):miJs.object(e[i]).equal(t)){return n?(this.result=i,this):i}}return n?(this.result=i,this):undefined};this.object=function(){e=this.result||e;var t=miJs.object(e,n);return n?(t.result=e,t):t};this.function=function(){e=this.result||e;var t=miJs.function(e,n);return n?(t.result=e,t):t};this.reduce=function(t,r){e=this.result||e;var i=r;if(e.reduce){i=e.reduce(t,i)}else{for(var s=0;s<e.length;s++){i=t(i,e[s])}}return n?(this.result=i,this):i};this.external=function(t,n){e=this.result||e;var r=t(e);if(n){this.result=r}return this};this.with=function(){e=this.result||e;miniJs.this=e;if(n){return this}}}function r(e,t){var n=!!t;this.result=undefined;this.chain=function(){n=!n;return n?this:this.result};this.cache=function(){var t=function(){for(var n in t.base.argument){if(t.base.argument.hasOwnProperty(n)&&miniJs.object(t.base.argument[n]).equal(arguments)){return t.base.retValue[n]}}t.base.argument.push(arguments);var r=e.apply(this,arguments);t.base.retValue.push(r);return r};var r;t.base={argument:[],retValue:[]};return n?(r=miJs.function(t,true),r.result=t,r):t};this.log=function(){var t=function(){var n=e.apply(this,arguments);t.log.push({args:arguments,ret:n});return n};var r;t.log=[];return n?(r=miJs.function(t,true),r.result=t,r):t};this.clone=function(){var t=function(){return e.apply({},arguments)};var r;return n?(r=miJs.function(t,true),r.result=t,r):t};this.objectArgument=function(){var t,r=Array.prototype.slice.call(arguments),i=function(t){var n=[],i=function(e,t){miJs.object(e,true).keys().array().each(function(s){var o=r.indexOf(t+s);if(o!==-1){n[o]=e[s]}else{i(e[s],t+s+".")}})};i(t,"");return e.apply(this,n)};return n?(t=miJs.function(i,true),t.result=i,t):i};this.profile=function(){var t,r=function(){var t=(new Date).getTime(),n=e.apply(this,arguments),i=(new Date).getTime()-t;r.count++;r.time.all.push(i);return n};r.time={max:function(){return Math.max.apply(Math,r.time.all)},min:function(){return Math.min.apply(Math,r.time.all)},middle:function(){var e=0;for(var t=0,n=r.time.all.length;t<n;t++){e+=r.time.all[t]}return e/n},all:[]};r.count=0;return n?(t=miJs.function(r,true),t.result=r,t):r};this.external=function(t,r){var i=t(e),s=miJs.function(i,n);if(r)s.result=i;return s}}function i(e,t){var n=!!t;this.result=undefined;this.chain=function(){n=!n;return n?this:this.result};this.lambda=function(){var t=[],n=e,r;if(/\s*:\s*/.test(n)!=null){r=e.split(/\s*:\s*/);t=r[0].split(/\s*,\s*|\s+/m);n=r.slice(1).join(":")}else{throw"String '"+e+"' can't convert to Function"}return new Function(t,"return ("+n+")")}}var e=function(e,s){if(arguments.length){if(e instanceof Array)return new n(e,s);if(typeof e=="function")return new r(e,s);if(typeof e=="string")return new i(e,s);return new t(e,s)}};e.object=function(e,n){return new t(e,n)};e.array=function(e,t){return new n(e,t)};e.function=function(e,t){return new r(e,t)};e.string=function(e,t){return new i(e,t)};e.alert=function(){var e="";for(var t=0;t<arguments.length;t++)e+=t+": "+arguments[t]+"\n";alert(e)};e.timer=function(){var e=(new Date).getTime();return function(){return(new Date).getTime()-e}};e.this=undefined;return e}()
